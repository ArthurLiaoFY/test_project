# 組裝產線強化學習系統 (進行中)

本專案針對一個組裝產線的部分系統，應用強化學習（Reinforcement Learning）來優化其運作流程。


## 系統更新率
3. Agent進行逐秒控制
4. 傳輸帶與機械手臂更新率0.033秒

## 系統簡介

該系統包含以下組件：
- 前方輸送帶：負責將待組裝產品送至前方產品緩存區。
- 產品緩存區（前方）：作為手臂與輸送帶間的連結點，方便藉此定義輸送帶與手臂是否該等待。
- 機械手臂：負責抓取產品，然後將產品移至後方貨物緩存區。
- 產品緩存區（後方）：作為手臂與輸送帶間的連結點，方便藉此定義輸送帶與手臂是否該等待。
- 後方輸送帶：負責將產品送至產品接收器。
- 產品接收器：負責產品接收。

該環境設定：
1. 環境初始速度為 0.5，上限為1，下限為0。
2. 若傳輸帶超過速度上限則貨物會因為慣性而移動。
3. 手臂為定速運行，前後傳輸帶可控制。

系統更新率：
1. Agent進行逐秒控制
2. 傳輸帶與機械手臂更新率0.033秒

### 運作流程
1. 若前方輸送帶有空閒，且前方緩存區有空間（一單位的空間），則運輸產品至前方緩存區，否則等待。
2. 產品送至前方緩存區後，若手臂空閒則抓取，否則等待。
3. 機械手臂抓取產品並送至後方緩存區（一單位的空間），若後方緩存區有產品堆積，則手臂於終點等待後方緩存區有空間後才能抓取前方緩存區的產品。
4. 若後方輸送帶有空閒，則輸送產品至終點，終點容量假設無上限。

## 目標
1. 盡可能減少輸送機運轉的時間(更少的機械耗損)
2. 適當的運輸速度(貨物不會因為慣性而飛出輸送帶掉落)
3. 最小化手臂等待的時間(更高效率的組裝跟出貨)
4. 最大化每小時出貨量

此處因為假設了手臂為定速運行，所以最小化手臂等待的時間與最大化每小時出貨量等價。

## 強化學習設計

### 1. 狀態空間 (State Space)
系統的狀態由以下變數組成：
  - 輸送帶至終點剩餘的長度
  - 輸送帶速度
  - 緩存區是否無空間
  - 手臂剩餘運行時間

### 2. 行動空間 (Action Space)
- **輸送帶操作**
  - 控制輸送帶的運行速度（0, -0.1, 0.1）

### 3. 獎勵函數 (Reward Function)
為了達成最佳目標，設計以下回饋函數：

- **出貨獎勵**：每成功出貨一件產品至前方緩存區，或是產品接收器，給予正向獎勵。
- **輸送帶剩餘距離逞罰**：若前方緩存區或收貨區為空，剩餘距離大小將作為逞罰。
- **輸送帶無產品運行逞罰**：若前方緩存區或收貨區有產品，則輸送帶應該降低運行速度，當前速度大小將作為逞罰。

回饋函數：
1. 前方輸送帶
```
conveyor_1_reward = (
    -1
    * (
        2
        * (1 - conveyor_state.get("head_buffer_full"))
        * conveyor_state.get("conveyor1_remain_length")
        + conveyor_state.get("head_buffer_full")
        * conveyor_state.get("conveyor1_speed")
    )
    if not conveyor_state.get("pass_one_to_head_buffer")
    else 1
)
```
2. 後方輸送帶
```
conveyor_2_reward (
    -1
    * (
        2
        * (1 - conveyor_state.get("tail_buffer_full"))
        * conveyor_state.get("conveyor2_speed")
        + conveyor_state.get("tail_buffer_full")
        * conveyor_state.get("conveyor1_remain_length")
    )
    if not conveyor_state.get("pass_one_to_sink")
    else 1
)
```

## 安裝與執行
1. **安裝依賴項目**
   ```bash
   pip install -r requirements.txt
   ```
2. **執行**
   ```bash
   python main.py
   ```
